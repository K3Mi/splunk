<dashboard theme="dark">
  <!-- Authored by David Paper (dpaper@splunk.com) and Troy Wollenslegel (twollenslegel@splunk.com) -->
  <label>Splunk - SH - 10 - TSAM Quarterly System Review - Dashboard - v0.12</label>
  <search>
    <query>| makeresults
 | eval now=strftime(relative_time(now(),"-0s"),"%+")
 | table now</query>
    <sampleRatio>1</sampleRatio>
    <preview>
      <set token="tok_now">$result.now$</set>
    </preview>
  </search>
  <row>
    <panel>
      <html>
     <h2>Requirements for this view</h2>
   <li>This view is designed to run on the same server that Monitoring Console is configured on, and relies on splunk server groups to be properly defined.</li>
   <li>This view requires MC be setup in distributed mode and all Server Roles correctly configured. See TSAM or Support for assistance if needed.</li>
   <li>This view must be run from within the MC so it has access to the necessary lookups and KOs.</li>
   
     
   </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Quick Counts</title>
      <table>
        <search>
          <query>| inputlookup dmc_assets | stats count by search_group | search search_group!=*indexerclustergroup* search_group!=*searchheadclustergroup*</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>Data Ingestion</html>
    </panel>
  </row>
  <row>
    <panel>
      <title>$tok_now$</title>
      <single>
        <search>
          <query>|rest /services/data/indexes | search totalEventCount!=0 | stats dc(title)</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="link.visible">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[500,550,600,650]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">Active Indexes</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <search>
          <query>|rest /services/data/indexes | stats dc(title)</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="link.visible">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[500,550,600,650]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">Total Configured Indexes</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Aggregation Errors - $tok_now$</title>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log component=AggregatorMiningProcessor (log_level=WARN OR log_level=ERROR)
            | rex field=message "Context: source::(?&lt;context_source&gt;[^\|]*?)\|host::(?&lt;context_host&gt;[^\|]*?)\|(?&lt;context_sourcetype&gt;[^\|]*?)\|"
            | eval data_source = if(isnull(data_source) AND isnotnull(context_source), context_source, data_source)
            | eval data_sourcetype = if(isnull(data_sourcetype) AND isnotnull(context_sourcetype), context_sourcetype, data_sourcetype)
            | timechart count(eval(component=="AggregatorMiningProcessor")) AS "Aggregation Issues" span=1h partial=false</query>
          <earliest>-2d@d</earliest>
          <latest>now</latest>
        </search>
        <option name="colorBy">trend</option>
        <option name="drilldown">none</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="trendInterval">-1h</option>
        <option name="useColors">1</option>
        <option name="link.visible">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Line Breaking Errors - $tok_now$</title>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log component=LineBreakingProcessor (log_level=WARN OR log_level=ERROR)
            | rex field=message "Context: source::(?&lt;context_source&gt;[^\|]*?)\|host::(?&lt;context_host&gt;[^\|]*?)\|(?&lt;context_sourcetype&gt;[^\|]*?)\|"
            | eval data_source = if(isnull(data_source) AND isnotnull(context_source), context_source, data_source)
            | eval data_sourcetype = if(isnull(data_sourcetype) AND isnotnull(context_sourcetype), context_sourcetype, data_sourcetype)
            | timechart count(eval(component=="LineBreakingProcessor")) AS "Line Breaking Issues" span=1h partial=false</query>
          <earliest>-2d@d</earliest>
          <latest>now</latest>
        </search>
        <option name="colorBy">trend</option>
        <option name="drilldown">none</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="trendInterval">-1h</option>
        <option name="useColors">1</option>
        <option name="link.visible">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Timestamp Parsing Errors - $tok_now$</title>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log component=DateParserVerbose (log_level=WARN OR log_level=ERROR)
            | rex field=message "Context: source::(?&lt;context_source&gt;[^\|]*?)\|host::(?&lt;context_host&gt;[^\|]*?)\|(?&lt;context_sourcetype&gt;[^\|]*?)\|"
            | eval data_source = if(isnull(data_source) AND isnotnull(context_source), context_source, data_source)
            | eval data_sourcetype = if(isnull(data_sourcetype) AND isnotnull(context_sourcetype), context_sourcetype, data_sourcetype)
            | timechart count(eval(component=="DateParserVerbose")) AS "Timestamp Parsing Issues" span=1h partial=false</query>
          <earliest>-2d@d</earliest>
          <latest>now</latest>
        </search>
        <option name="colorBy">trend</option>
        <option name="drilldown">none</option>
        <option name="link.visible">1</option>
        <option name="refresh.display">progressbar</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="trendInterval">-1h</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Quality of Incoming Data - $tok_now$</title>
      <table>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log 
    (component=AggregatorMiningProcessor OR component=LineBreakingProcessor OR component=DateParserVerbose)
    (log_level=WARN OR log_level=ERROR) 
| rex field=message "Context: source::(?&lt;context_source&gt;[^\|]*?)\|host::(?&lt;context_host&gt;[^\|]*?)\|(?&lt;context_sourcetype&gt;[^\|]*?)\|" 
| eval data_source = if(isnull(data_source) AND isnotnull(context_source), context_source, data_source) 
| eval data_sourcetype = if(isnull(data_sourcetype) AND isnotnull(context_sourcetype), context_sourcetype, data_sourcetype) 
| stats
    count(eval(component=="LineBreakingProcessor" OR component=="DateParserVerbose" OR component=="AggregatorMiningProcessor")) as total_issues
    dc(data_source) AS "Source Count"
    count(eval(component=="LineBreakingProcessor")) AS "Line Breaking Issues"
    count(eval(component=="DateParserVerbose")) AS "Timestamp Parsing Issues"
    count(eval(component=="AggregatorMiningProcessor")) AS "Aggregation Issues" by data_sourcetype 
| sort - total_issues 
| where total_issues &gt;= 1000 
| rename
    data_sourcetype as sourcetype 
| join sourcetype 
    [| tstats count where index=* by sourcetype 
    | rename count as totalEvents] 
| eval percErrs=round(100*(total_issues/totalEvents),2) 
| table sourcetype, totalEvents, total_issues, percErrs, "Source Count", "Line Breaking Issues", "Timestamp Parsing Issues", "Aggregation Issues" 
| rename sourcetype AS Sourcetype, totalEvents AS "Total Events", percErrs AS "Error %", total_issues AS "Total Issues" 
| head 10</query>
          <earliest>-1d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Forwarder Restarts - $tok_now$</title>
      <table>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log "Splunkd starting" component=loader | top host limit=10 | where count&gt;4 | fields - percent | rename count AS Count, host AS Host</query>
          <earliest>-2d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>Indexing tier</html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Search Peer Transitions - $tok_now$</title>
      <chart>
        <search>
          <query>index=_internal sourcetype=splunkd source=*splunkd.log component=CMPeer peer transitioning NOT bid | eval transition = from." -&gt; ".to | timechart count by transition</query>
          <earliest>-15d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>Hot bucket rolls - $tok_now$</title>
      <chart>
        <search>
          <query>index=_internal source=*splunkd.log sourcetype=splunkd component=HotBucketRoller | rename idx AS Index | timechart span=15m count by Index limit=10 | rename VALUE_* AS "splunk_*"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>Search Tier</html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Efficiency Search - $tok_now$</title>
      <!-- To exclude all the junk: (user=* AND savedsearch_name!=_ACCELERATE_* AND user!=admin AND user!=nobody) -->
      <table>
        <search>
          <query>index=_internal sourcetype=scheduler source=*scheduler.log (user=* AND savedsearch_name!=_ACCELERATE_* AND user!=admin AND user!=nobody)
| stats avg(run_time) as average_runtime_in_sec count(savedsearch_name) as weekly_count sum(run_time) as total_runtime_sec by savedsearch_name user app host
| eval Ran_every_x_Minutes=60/(weekly_count/168)
| eval average_runtime_in_minutes=average_runtime_in_sec/60
| eval efficiency=((60/(weekly_count/168))/(average_runtime_in_sec/60))
| sort efficiency | head 10
| rename savedsearch_name AS "Saved Search Name", user AS "User", efficiency AS "Efficiency", app AS "App", host AS "Host", average_runtime_in_sec AS "Avg Runtime Secs", weekly_count AS "Weekly Count", total_runtime_sec AS "Total Runtime Secs", Ran_every_x_Minutes AS "Ran Every X Mins", average_runtime_in_minutes AS "Avg Runtime In Mins"
| table "Saved Search Name","User", "Efficiency", "App", "Host", "Avg Runtime Secs", "Weekly Count", "Total Runtime Secs", "Ran Every X Mins", "Avg Runtime In Mins"</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Events Scanned vs Returned - $tok_now$</title>
      <table>
        <search>
          <query>index=_audit search_id TERM(action=search) (info=granted OR info=completed)  (user=* AND savedsearch_name!=_ACCELERATE_* AND user!=admin AND user!=nobody)
| stats first(_time) as _time first(total_run_time) as total_run_time first(event_count) as event_count first(scan_count) as
   scan_count first(user) as user first(savedsearch_name) as savedsearch_name first(search) as search_snippet by search_id 
| eval lispy_efficiency = event_count / scan_count 
| where lispy_efficiency &lt; 0.5 AND total_run_time &gt; 5 AND scan_count &gt; 100
| sort - total_run_time | eval search_snippet=substr(search_snippet,1,50) . "..." | head 10
| table total_run_time event_count scan_count lispy_efficiency user savedsearch_name search_snippet _time search_id</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Default indexed field usage by user - $tok_now$</title>
      <table>
        <search>
          <query>user=* index=_audit action=search sourcetype=audittrail search_id=* user!="splunk-system-user" info=granted  
| eval search=replace(search,"(search\s)(.*)","\2") 
| eval savedsearch_name=replace(savedsearch_name,"(search\d+)","dashboard") 
| eval savedsearch_name=if(savedsearch_name="","adhoc",savedsearch_name) 
| stats count by user, savedsearch_name, search | rex field=search "host=(?&lt;host&gt;\S+)"  
| rex field=search "sourcetype=(?&lt;sourcetype&gt;\S+)"  
| rex field=search "source=(?&lt;source&gt;\S+)"  
| rex field=search "index=(?&lt;index&gt;[^\s\=]+)" 
| eval index=trim(index,"\""), host=trim(host,"\"\\'"), sourcetype=trim(sourcetype,"\"") ,source=trim(source,"\"")  
| stats values(index) as searched_indexes, values(sourcetype) as searched_sourcetypes, values(source) as searched_sources, values(host) as searched_hosts by user | head 10</query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Duration #1 - $tok_now$</title>
      <table>
        <title>Limited to top 12 results</title>
        <search>
          <query>index=_audit info=completed sourcetype=audittrail source=audittrail
| eval search_span=round(search_lt-search_et)
| convert ctime(search_et) ctime(search_lt)
| eval search_span=tostring(abs(search_span), "duration")
| top limit=12 search_span
| rename count AS "Count", percent AS "Percent", search_span AS "Search Span"
| table "Search Span", "Count", "Percent" </query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel>
      <title>Duration #2 - $tok_now$</title>
      <table>
        <search>
          <query>index=_audit sourcetype=audittrail source=audittrail TERM(action=search) ( TERM(info=completed) OR ( TERM(info=granted) apiStartTime "search='search")) NOT "search_id='rsa_*"  host="sh1.vanguardgroup.splunkcloud.com" 
| eval u=case( searchmatch("user=splunk-system-user OR user=nobody OR search_id=*scheduler_*"), "Scheduler", searchmatch("search_id=1* OR search_id='1*"), "AdHocUser", 1=1, "AdHocSaved") 
| eval search_id=md5(search_id), search_et=if(search_et="N/A", 0, search_et), search_lt=if(search_lt="N/A", exec_time, search_lt), et_diff=case(exec_time&gt;search_et, (exec_time-search_et)/60, 1=1, (search_lt-search_et)/60), searchStrLen=len(search) 
| stats partitions=10 sum(searchStrLen) AS searchStrLen, count, first(et_diff) AS et_diff, first(u) as u, values(search) AS search BY search_id 
| search searchStrLen&gt;0 et_diff=* count&gt;1 
| eval Et_range=case(et_diff&lt;=0, "WTF", et_diff&lt;2, "0_1m", et_diff&lt;6, "1_5m", et_diff&lt;11, "2_10m", et_diff&lt;16, "3_15m", et_diff&lt;=65, "4_60m", et_diff&lt;=4*60+10, "5_4h", et_diff&lt;=24*60+10, "6_24h", et_diff&lt;=7*24*60+10, "7_7d", et_diff&lt;=30*24*60+10, "8_30d", et_diff&lt;=90*24*60+10, "9_90d", 1=1, "10_&gt;90d") 
| chart count by Et_range, u 
| eval Total=AdHocUser + AdHocSaved + Scheduler 
| eventstats sum(AdHocUser) AS uTotal sum(AdHocSaved) AS aTotal, sum(Scheduler) AS sTotal, sum(Total) AS tTotal 
| eval AdHocUserPerc=round((AdHocUser*100)/uTotal,3), AdHocSavedPerc=round((AdHocSaved*100)/aTotal,3), SchedulerPerc=round((Scheduler*100)/sTotal, 3), TotalPerc=round((Total*100)/tTotal, 3) 
| addcoltotals 
| eval Et_range=if(isnull(Et_range), "8_Total", Et_range) 
| fields - aTotal sTotal tTotal, uTotal 
| rex mode=sed field=Et_range "s/\d+_(.*)/\1/g" 
| accum TotalPerc AS TotalPercCumulative 
| eval TotalPercCumulative=if(TotalPercCumulative&lt;101, round(TotalPercCumulative, 1), "") 
| table Et_range AdHocUser AdHocUserPerc AdHocSaved AdHocSavedPerc Scheduler SchedulerPerc TotalPercCumulative 
| rename Et_range AS "Search Span"</query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Search Scheduling Distribution - $tok_now$</title>
      <chart>
        <search>
          <query>| rest /servicesNS/-/-/saved/searches splunk_server_group=dmc_group_search_head search="is_scheduled=1" search="disabled=0" earliest_time=-60m@m latest_time=now | table title cron_schedule scheduled_times | mvexpand scheduled_times | rename scheduled_times as _time | timechart span=1m count as "Searches Scheduled"</query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="height">400</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Frequency of Scheduled Searches - $tok_now$</title>
      <table>
        <title>Limited to top 10 results</title>
        <search>
          <query>| rest /servicesNS/-/-/saved/searches splunk_server_group=dmc_group_search_head | search is_scheduled=1 disabled=0 
| eval temp=split(splunk_server,".") 
| eval hostname=mvindex(temp,0) 
| chart count over cron_schedule by hostname 
| addtotals fieldname=total 
| sort limit=10 - total</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Dashboards Hitting Limits - $tok_now$</title>
      <chart>
        <search>
          <query>index=_internal search_group="dmc_group_search_head"  sourcetype=splunkd reason="The maximum*"
provenance=* | timechart count by provenance limit=20</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Types of maximums reached and what drives them - $tok_now$</title>
      <table>
        <search>
          <query>index=_internal search_group=dmc_group_search_head sourcetype=splunkd reason="The maximum*" NOT "reason=\"The maximum*\"" provenance=* 
| chart count over provenance by reason 
| sort - 
    [ search index=_internal search_group=dmc_group_search_head sourcetype=splunkd reason="The maximum*" provenance=* 
    | stats count by reason 
    | sort - count 
    | head 1 
    | eval reason="\"".reason."\"" 
    | appendpipe 
        [ stats count 
        | eval "reason"="This should be empty if everything OK" 
        | where count==0 
        | table "reason"] 
    | return $$reason ] 
| head 10 
| appendpipe 
    [ stats count 
    | eval "provenance"="This should be empty if everything OK" 
    | where count==0 
    | table "provenance"]</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Bundle size by host - $tok_now$</title>
      <chart>
        <title>30 days</title>
        <search>
          <query>index=_internal sourcetype=splunkd group=bundles_uploads search_group=dmc_group_search_head  
| eval baseline_bundle_size_mb=(average_baseline_bundle_bytes/1024)/1024 
| timechart span=1h avg(baseline_bundle_size_mb) AS baseline_bundle_size by host</query>
          <earliest>-30d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>RF/SF Fixup Tasks Queued - $tok_now$</title>
      <chart>
        <title>Log scale, 30 days</title>
        <search>
          <query>index=_internal search_group=dmc_group_cluster_master  source=*metrics.log sourcetype=splunkd name=cmmaster_service  group=subtask_counts 
| timechart span=8h max(to_fix_rep_factor) AS "RF Fixups To Do" max(to_fix_search_factor) AS "SF Fixups To Do" partial=false</query>
          <earliest>-30d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Ulimits - $tok_now$</title>
      <table>
        <search>
          <query>| rest splunk_server=* /services/server/info 
| join type=outer splunk_server [rest splunk_server_group=* /services/server/sysinfo | fields splunk_server ulimits.data_segment_size ulimits.open_files ulimits.user_processes]
| eval ulimits.data_segment_size = if(isnotnull('ulimits.data_segment_size'), 'ulimits.data_segment_size', "unavailable")
| eval ulimits.open_files = if(isnotnull('ulimits.open_files'), 'ulimits.open_files', "unavailable")
| eval ulimits.user_processes = if(isnotnull('ulimits.user_processes'), 'ulimits.user_processes', "unavailable")
| eval sev_segment_size = case('ulimits.data_segment_size' == -1 OR 'ulimits.data_segment_size' &gt;= 1073741824, 0, 'ulimits.data_segment_size' == "unavailable", -1, True(), 2)
| eval sev_open_files = case('ulimits.open_files' == -1 OR 'ulimits.open_files' &gt;= 8192, 0, 'ulimits.open_files' == "unavailable", -1, True(), 2)
| eval sev_user_processes = case('ulimits.user_processes' == -1 OR 'ulimits.user_processes' &gt;= 8192, 0, 'ulimits.user_processes' == "unavailable", -1, True(), 2)
| eval severity_level = max(sev_segment_size, sev_open_files, sev_user_processes) | eval splunk_server=split(splunk_server,".") 
| eval splunk_server=mvindex(splunk_server,0) 
| fields splunk_server ulimits.data_segment_size ulimits.open_files ulimits.user_processes severity_level
| rename splunk_server AS instance ulimits.data_segment_size AS "ulimits.data_segment_size (current / recommended)" ulimits.open_files AS "ulimits.open_files (current / recommended)" ulimits.user_processes AS "ulimits.user_processes (current / recommended)"
| fieldformat ulimits.data_segment_size (current / recommended) = if('ulimits.data_segment_size (current / recommended)' &gt;= 0, 'ulimits.data_segment_size (current / recommended)'." / 1073741824", 'ulimits.data_segment_size (current / recommended)')
| fieldformat ulimits.open_files (current / recommended) = if('ulimits.open_files (current / recommended)' &gt;= 0, 'ulimits.open_files (current / recommended)'." / 8192", 'ulimits.open_files (current / recommended)')
| fieldformat ulimits.user_processes (current / recommended) = if('ulimits.user_processes (current / recommended)' &gt;= 0, 'ulimits.user_processes (current / recommended)'." / 8192", 'ulimits.user_processes (current / recommended)')
| fields - _timediff | sort - severity_level | head 10</query>
          <earliest>-30d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel>
      <title>Transparent Huge Pages - $tok_now$</title>
      <table>
        <search>
          <query>| rest splunk_server_group=* /services/server/info 
| join type=outer splunk_server [rest splunk_server_group=* /services/server/sysinfo | fields splunk_server transparent_hugepages.*]
| eval transparent_hugepages.effective_state = if(isnotnull('transparent_hugepages.effective_state'), 'transparent_hugepages.effective_state', "unknown")
| eval transparent_hugepages.enabled = case(len('transparent_hugepages.enabled') &gt; 0, 'transparent_hugepages.enabled', 'transparent_hugepages.effective_state' == "ok" AND (isnull('transparent_hugepages.enabled') OR len('transparent_hugepages.enabled') = 0), "feature not available", 'transparent_hugepages.effective_state' == "unknown" AND isnull('transparent_hugepages.enabled'), "unknown")
| eval transparent_hugepages.defrag = case(len('transparent_hugepages.defrag') &gt; 0, 'transparent_hugepages.defrag', 'transparent_hugepages.effective_state' == "ok" AND (isnull('transparent_hugepages.defrag') OR len('transparent_hugepages.defrag') = 0), "feature not available", 'transparent_hugepages.effective_state' == "unknown" AND isnull('transparent_hugepages.defrag'), "unknown")
| eval severity_level = case('transparent_hugepages.effective_state' == "unavailable", -1, 'transparent_hugepages.effective_state' == "ok", 0, 'transparent_hugepages.effective_state' == "unknown", 1, 'transparent_hugepages.effective_state' == "bad", 2) 
| eval splunk_server=split(splunk_server,".") 
| eval splunk_server=mvindex(splunk_server,0)
| fields splunk_server transparent_hugepages.enabled transparent_hugepages.defrag transparent_hugepages.effective_state severity_level
| rename splunk_server AS instance  transparent_hugepages.effective_state AS THP.effective_state transparent_hugepages.defrag AS THP.defrag transparent_hugepages.enabled AS THP.enabled
| fields - _timediff | sort -severity_level | head 10</query>
          <earliest>-30d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</dashboard>
